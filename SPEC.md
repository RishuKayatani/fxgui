# FXGUI Spec（正本）

本書はFXチャートアプリ（Rust/Tauri/React + fxlib）の全体要件を定義する正本です。
分割Specは `spec/` 配下に置き、重複は本書に集約します。

## 0. 目次 / 構成
- 1. 目的 / ビジョン
- 2. 対象ユーザー / 利用シーン
- 3. 主要ユースケース（3〜5）
- 4. UX優先順位
- 5. UI絶対条件
- 6. 制約
- 7. 成功指標
- 8. 用語/概念の定義
- 9. 対象外
- 10. 依存関係
- 11. リスク/不確実性
- 12. 想定ユーザーフロー（最短）
- 13. データ/権限/プライバシー方針
- 14. 非機能要件
- 15. 変更履歴
- 16. 判断主体ラベル
- 17. 機能決定ログ（人間主導）
- 18. LLM提案ログ（実装/データ設計）
- 19. Spec群の整合ルール

## 1. 目的 / ビジョン
- FXチャート分析を高速に行えるデスクトップアプリを提供する。
- `fxlib` をコアに据え、描画・分析・データ処理を一貫して高速化する。

## 2. 対象ユーザー / 利用シーン
- 対象ユーザー: 短期〜中期のFXトレーダー、チャート分析に時間を割く個人/小規模チーム。
- 利用シーン: 相場確認、テクニカル分析、過去検証、取引前の意思決定。

## 3. 主要ユースケース（3〜5）
1. 複数通貨ペアのチャートを素早く切り替えて確認する
2. インジケーターを追加/調整して分析する
3. 期間・足の種類を変更して過去の相場を検証する
4. 描画設定を保存/再利用する

## 3.0 主要ユースケースの具体化（第1版）
- UC1: CSV読み込み → チャート表示
  - 起動 → CSV選択 → 読み込み → チャート表示
  - 失敗時はエラーメッセージと再選択導線
- UC2: 通貨ペア切替
  - 左パネルから選択 → 対象チャート更新
  - 分割時はアクティブ枠のみ切替
- UC3: 足の種類/期間変更
  - 上部の足の種類セレクタで変更
  - 変更後は即時再描画
- UC4: インジケーター追加/調整
  - 右パネルから追加
  - パラメータ編集 → 即時反映
  - ON/OFF切替可能
- UC5: プリセット保存/読込
  - 現在のチャート構成を保存
  - 保存済みプリセットから即時復元
- UC6: バックテスト再生/シーク
  - 再生/一時停止/速度変更
  - 進行バーで位置変更（巻き戻し）

## 3.1 主要機能の詳細（第1版）
### A. チャート表示
- チャート種別: ローソク足 / ライン / バー（最低限: ローソク足）
- 時間足: M1/M5/M15/M30/H1/H4/D1（拡張可能）
- ズーム / スクロール / 十字カーソル
- 分割表示: 画面分割で複数チャートを同時表示（最小: 2分割）

### B. 通貨ペア切替
- 主要ペアをプリセット（初期はプリセットのみ）
- 切替はワンクリック/キーボードで迅速に

### C. インジケーター
- 最低限: MA, RSI, MACD
- パラメータ調整（期間/色/太さ）
- 表示ON/OFF切替

### D. 描画設定/保存
- チャート種別、時間足、インジ設定をプリセットとして保存
- 保存/読み込み/削除

### E. データ入力（バックテスト前提）
- CSVからデータを読み込み、仮想環境で再生/検証する
- ライブデータは初期対象外

## 3.2 データ仕様（第1版）
### A. CSVフォーマット（最小）
- 1ファイル=1通貨ペア+1足
- 行ごとに時系列のOHLC
- timestamp形式は `YYYY.MM.DD H:MM:SS` を基本とする
  - 例: `2003.05.05	0:01:00`（区切りはタブ/スペース）
- 必須カラム: `timestamp`, `open`, `high`, `low`, `close`
- `volume` は任意（未提供なら0扱い）

### B. 時間足の扱い
- CSVの時間間隔から足の種類を推定する
- 上位足はアプリ側で生成（例: M1→M5/H1）

### C. 欠損データ
- 欠損は補間せず欠損のまま扱う（初期）

### D. バックテスト再生
- 再生/一時停止は必須
- 巻き戻しは要望あり（実現方法は今後確定）

## 3.3 UX詳細（第1版）
### A. 画面構成（初期）
- 左: 通貨ペア/データセット一覧
- 中央: チャート領域（分割表示対応）
- 右: インジケーター設定/描画設定
- 上: 期間・足の種類・再生コントロール

### B. 分割表示の操作
- 1/2/4分割の切替
- 分割ごとに通貨ペア/足の種類/インジを独立設定
- 時間軸同期のON/OFF

### C. バックテスト操作
- 再生/一時停止/速度変更
- 進行バーで位置変更
- 巻き戻しは進行バー操作で実現

### D. 初期導線
- 起動時にCSV読み込みCTA
- 最近使ったデータセット履歴

### E. ショートカット（暫定）
- Space: 再生/一時停止
- 1/2/4: 分割切替
- ←/→: 前後バー移動

## 3.4 依存/連携方式（fxlib）
### A. 取り込み方法
- 初期はGit submoduleで `fxlib` を `core/fxlib` に配置
- 将来はcrate依存（git dependency）へ移行可能

### B. 責務境界
- fxlib: データ解析/インジ計算/バックテスト用のコア処理
- fxgui: UI/操作/レイアウト/描画（レンダリング）

### C. API境界（案）
- データロード: `fxlib::load_csv(path) -> DataSet`
- 時間足生成: `fxlib::resample(dataset, interval)`
- インジ計算: `fxlib::indicator::ma/rsi/macd(...)`
- バックテスト再生: `fxlib::playback::step/seek(...)`

### D. 互換性方針
- fxlibの変更は都度判断（固定ポリシーは設けない）

## 4. UX優先順位
1. 最短で「見たいチャート」に到達できる
2. 操作の一貫性（設定・切替・保存の導線が統一されている）
3. 表示の即応性（操作に対する遅延が体感されない）

## 5. UI絶対条件
- 意図と形の一致（ボタン/パネル/チャート要素が意図通りに見える）
- 構造の可視性（階層/関連性が画面上で理解できる）
- 配置規則の一貫（同種操作は同位置・同形状）

## 6. 制約
- 技術: Rust + Tauri + React を前提。
- コア処理は `fxlib` を利用し、機能重複は避ける。
- オフラインでも最低限のチャート閲覧が可能であること。

## 7. 成功指標
- 起動〜初回表示: 3秒以内の達成率80%以上
- 主要操作ステップ数
  - 通貨ペア切替: 2ステップ以内
  - 足の種類切替: 2ステップ以内
  - インジ追加: 3ステップ以内
- 週次継続率: 30%以上（初期目標）
- バックテスト操作性
  - 再生/停止の操作失敗率 < 1%

## 8. 用語/概念の定義
- Core: `fxlib` を中心とした分析/描画ロジック
- GUI: Tauri + React のUI層
- インジケーター: テクニカル指標（MA/RSI等）
- 足の種類: 時間足の種類（1分足/5分足/1時間足/日足など）
- 時間足: ローソク足1本の期間（分足/時間足/日足/週足/月足）
- データセット: CSVから読み込んだ1通貨ペア+1足のデータ単位
- 分割表示: 画面を複数領域に分けて複数チャートを同時表示
- プリセット: チャート種別・足の種類・インジ設定の保存単位
- キャッシュ: CSV読み込み結果をローカルに保存して高速化する仕組み
- シーク: 再生位置の移動（巻き戻し/早送り）

## 9. 対象外
- 実取引の注文/発注機能
- ソーシャル/コミュニティ機能
- ブローカー口座連携
- ライブデータの自動取得/配信

## 10. 依存関係
- `fxlib`（https://github.com/RishuKayatani/fxlib）
- Rust / Node.js / Tauri toolchain

## 11. リスク/不確実性
- CSV/TSVの区切りや時刻表記の揺れ
  - 対応策: 入力時のフォーマット検証と簡易変換
- 大量データ時の性能
  - 間引きは行わず、仮想スクロールで対応
  - 遅延ロードと警告表示は許容
- 分割表示の状態管理複雑化
  - 対応策: 分割単位の状態モデルを明確化
- fxlib仕様変更
  - 対応策: サブモジュール固定＋都度判断
- 巻き戻し実装の難易度
  - 1バー単位のシークを基本とする

## 12. 想定ユーザーフロー（最短）
1. 起動
2. CSV読み込み
3. 通貨ペア選択
4. 期間・足の種類選択
5. チャート表示（必要なら分割）
6. インジケーター追加

## 13. データ/権限/プライバシー方針
- CSVは読み込み後にキャッシュ化し、次回高速に読み出せるようにする
- 設定/プリセット/レイアウトはローカルに保存（OS標準のアプリデータ領域）
- 取り扱うのは価格データ（OHLC）と設定情報のみ（個人情報は扱わない）
- ファイル読み込み権限のみ（ユーザーが選択したCSVに限定）
- ネットワーク通信は初期無効（明示的に有効化しない）
- エラー/操作ログはローカル保存、外部送信は行わない（必要時は明示同意）

## 14. 非機能要件
- 起動から最初のチャート表示まで: 3秒以内（CSVサイズ小〜中）
- CSV読み込み完了から表示反映: 1秒以内
- UI操作の反応時間: 100ms以内
- チャート更新FPS: 60fps以上（バックテスト再生中）
- 1チャートあたり最大10万バー目安（超過時は警告）
- メモリ上限目安: 2GB以内（通常利用）
- CSV破損/欠損時は警告表示し安全に停止
- 異常系でもクラッシュしない（ログ出力）

## 15. 変更履歴
- 2026-01-28: 初版作成
- 2026-01-28: 主要機能の詳細（バックテスト/分割表示）を追記
- 2026-01-28: データ仕様（CSV/欠損/巻き戻し要望）を追記
- 2026-01-28: UX詳細（画面構成/分割/ショートカット）を追記
- 2026-01-28: 非機能要件の数値化を追記
- 2026-01-28: 依存/連携方式（fxlib）を追記
- 2026-01-28: データ/権限/プライバシー方針を具体化
- 2026-01-28: 主要ユースケースの具体化を追記
- 2026-01-28: リスク/不確実性を具体化
- 2026-01-28: 成功指標の数値化を追記
- 2026-01-28: 用語/概念の追加整理を追記
- 2026-01-28: 決定ログ/提案ログを更新

## 16. 判断主体ラベル
- 人間決定: 機能定義/UX優先順位/対象外/成功指標
- LLM提案: データ設計/内部形式/実装詳細
- 共同確認: 非機能要件/制約/リスク

## 17. 機能決定ログ（人間主導）
- バックテスト前提（CSV読み込み）で進める
- ライブデータは対象外
- 画面分割を実装する
- CSV/TSV両対応、欠損は補間しない
- 巻き戻しは1バー単位のシーク
- 足種表記は「足の種類」を採用

## 18. LLM提案ログ（実装/データ設計）
- CSVキャッシュ化（読み込み高速化）を提案 → 承認済み
- UXレイアウト（左一覧/中央チャート/右設定/上部操作）を提案 → 承認済み
- 非機能目標（起動3秒/表示1秒/60FPS/2GB）を提案 → 承認済み

## 19. Spec群の整合ルール
- 詳細仕様は `spec/` 配下に分割する。
- 仕様の重複・衝突は本書（正本）で解決する。
- 変更時は必ず変更履歴に記録する。
